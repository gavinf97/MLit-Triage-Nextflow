<!DOCTYPE article PUBLIC "-//NLM//DTD Journal Archiving and Interchange DTD v3.0 20080202//EN" "archivearticle3.dtd"> 
<article xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" article-type="research-article"><?properties open_access?><front><journal-meta><journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id><journal-id journal-id-type="publisher-id">bioinformatics</journal-id><journal-id journal-id-type="hwp">bioinfo</journal-id><journal-title-group><journal-title>Bioinformatics</journal-title></journal-title-group><issn pub-type="ppub">1367-4803</issn><issn pub-type="epub">1460-2059</issn><publisher><publisher-name>Oxford University Press</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="pmcid">2665034</article-id><article-id pub-id-type="pmid">18586734</article-id><article-id pub-id-type="doi">10.1093/bioinformatics/btn189</article-id><article-id pub-id-type="publisher-id">btn189</article-id><article-categories><subj-group subj-group-type="heading"><subject>Ismb 2008 Conference Proceedings 19&#x02013;23 July 2008, Toronto</subject><subj-group><subject>Original Papers</subject><subj-group><subject>Other Bioinformatics Applications and Methods</subject></subj-group></subj-group></subj-group></article-categories><title-group><article-title>Modeling peptide fragmentation with dynamic Bayesian networks for peptide identification</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Klammer</surname><given-names>Aaron A.</given-names></name><xref ref-type="aff" rid="AFF1"><sup>1</sup></xref></contrib><contrib contrib-type="author"><name><surname>Reynolds</surname><given-names>Sheila M.</given-names></name><xref ref-type="aff" rid="AFF1"><sup>2</sup></xref></contrib><contrib contrib-type="author"><name><surname>Bilmes</surname><given-names>Jeff A.</given-names></name><xref ref-type="aff" rid="AFF1"><sup>2</sup></xref><xref ref-type="aff" rid="AFF1"><sup>3</sup></xref></contrib><contrib contrib-type="author"><name><surname>MacCoss</surname><given-names>Michael J.</given-names></name><xref ref-type="aff" rid="AFF1"><sup>1</sup></xref></contrib><contrib contrib-type="author"><name><surname>Noble</surname><given-names>William Stafford</given-names></name><xref ref-type="aff" rid="AFF1"><sup>1</sup></xref><xref ref-type="aff" rid="AFF1"><sup>3</sup></xref><xref ref-type="corresp" rid="COR1">*</xref></contrib></contrib-group><aff id="AFF1"><sup>1</sup>Department of Genome Sciences, <sup>2</sup>Department of Electrical Engineering and <sup>3</sup>Department of Computer Science and Engineering, University of Washington, Seattle, WA, USA</aff><author-notes><corresp id="COR1">*To whom correspondence should be addressed.</corresp></author-notes><pub-date pub-type="ppub"><day>1</day><month>7</month><year>2008</year></pub-date><pub-date pub-type="pmc-release"><day>1</day><month>7</month><year>2008</year></pub-date><!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="ppub"/>. --><volume>24</volume><issue>13</issue><fpage>i348</fpage><lpage>i356</lpage><permissions><copyright-statement>&#x000a9; 2008 The Author(s)</copyright-statement><copyright-year>2008</copyright-year><license license-type="creative-commons" xlink:href="http://creativecommons.org/licenses/by-nc/2.0/uk/"><license-p><!--CREATIVE COMMONS-->This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/2.0/uk/">http://creativecommons.org/licenses/by-nc/2.0/uk/</ext-link>) which permits unrestricted non-commercial use, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p></license></permissions><abstract><p><bold>Motivation:</bold> Tandem mass spectrometry (MS/MS) is an indispensable technology for identification of proteins from complex mixtures. Proteins are digested to peptides that are then identified by their fragmentation patterns in the mass spectrometer. Thus, at its core, MS/MS protein identification relies on the relative predictability of peptide fragmentation. Unfortunately, peptide fragmentation is complex and not fully understood, and what is understood is not always exploited by peptide identification algorithms.</p><p><bold>Results:</bold> We use a hybrid dynamic Bayesian network (DBN)/support vector machine (SVM) approach to address these two problems. We train a set of DBNs on high-confidence peptide-spectrum matches. These DBNs, known collectively as Riptide, comprise a probabilistic model of peptide fragmentation chemistry. Examination of the distributions learned by Riptide allows identification of new trends, such as prevalent <italic>a</italic>-ion fragmentation at peptide cleavage sites C-term to hydrophobic residues. In addition, Riptide can be used to produce likelihood scores that indicate whether a given peptide-spectrum match is correct. A vector of such scores is evaluated by an SVM, which produces a final score to be used in peptide identification. Using Riptide in this way yields improved discrimination when compared to other state-of-the-art MS/MS identification algorithms, increasing the number of positive identifications by as much as 12% at a 1% false discovery rate.</p><p><bold>Availability:</bold> Python and C source code are available upon request from the authors. The curated training sets are available at <ext-link ext-link-type="uri" xlink:href="http://noble.gs.washington.edu/proj/intense/">http://noble.gs.washington.edu/proj/intense/</ext-link>. The Graphical Model Tool Kit (GMTK) is freely available at <ext-link ext-link-type="uri" xlink:href="http://ssli.ee.washington.edu/bilmes/gmtk">http://ssli.ee.washington.edu/bilmes/gmtk</ext-link>.</p><p><bold>Contact:</bold><email>noble@gs.washington.edu</email></p></abstract></article-meta></front><body><sec sec-type="intro" id="SEC1"><title>1 INTRODUCTION</title><p>A major goal in biology is the identification and characterization of the cell's entire protein complement, or proteome. Toward this end, tandem mass spectrometry (MS/MS)-based technologies offer the ability to rapidly identify proteins in complex mixtures (Mann <italic>et al.</italic>, <xref ref-type="bibr" rid="B18">2001</xref>; Yates, <xref ref-type="bibr" rid="B32">1998</xref>). An essential step in MS/MS is the fragmentation of a protonated peptide and detection of the resulting fragment ions in the form of a mass spectrum. Due to the complex chemistry of peptide fragmentation, the pattern of peaks in such a spectrum can be predicted only qualitatively: an exact prediction of spectrum peak heights, or even which peaks will be present or absent, has proven elusive (Dancik <italic>et al.</italic>, <xref ref-type="bibr" rid="B4">1999</xref>; Elias <italic>et al.</italic>, <xref ref-type="bibr" rid="B6">2004</xref>; Wan and Chen, <xref ref-type="bibr" rid="B30">2005</xref>; Zhang, <xref ref-type="bibr" rid="B35">2004</xref>).</p><p>One motivation for modeling peptide fragmentation is to aid in the assignment of peptide sequences to observed fragmentation spectra. However, because of the complexity of peptide fragmentation, designers of peptide spectrum identification software have often relied heavily on expert knowledge to design simple heuristics (Eng <italic>et al.</italic>, <xref ref-type="bibr" rid="B5">1994</xref>; Field <italic>et al.</italic>, <xref ref-type="bibr" rid="B7">2002</xref>) or to set probabilities within a larger model (Bafna and Edwards, <xref ref-type="bibr" rid="B1">2001</xref>). Only recently models trained on actual mass spectrometry data have been pursued (Dancik <italic>et al.</italic>, <xref ref-type="bibr" rid="B4">1999</xref>; Elias <italic>et al.</italic>, <xref ref-type="bibr" rid="B6">2004</xref>; Havilio <italic>et al.</italic>, <xref ref-type="bibr" rid="B11">2003</xref>; Wan and Chen, <xref ref-type="bibr" rid="B30">2005</xref>). These peptide identification methods typically use relatively simple models that leave out large portions of known fragmentation pathways, such as neutral losses (Elias <italic>et al.</italic>, <xref ref-type="bibr" rid="B6">2004</xref>; Wan and Chen, <xref ref-type="bibr" rid="B30">2005</xref>), or incorporate most of the known fragmentation pathways in a black box model that is not easily interpreted or extended (Zhang, <xref ref-type="bibr" rid="B35">2004</xref>).</p><p>The method presented here builds upon and extends this previous work in an effort to address the limitations of existing fragmentation models and search methods. We test two closely related hypotheses: the first is that an improved model of peptide mass spectrum peak intensity, trained on actual MS/MS data, will provide insight into the complex chemistry of protonated peptide fragmentation; the second is that such a model will be useful for improving identification of unknown peptide fragmentation spectra, especially in conjunction with a sequence database search. We address these hypotheses using a machine learning tool known as the dynamic Bayesian network (DBN).</p><p>A Bayesian network is a type of graphical model (Lauritzen, <xref ref-type="bibr" rid="B17">1996</xref>), a mathematical tool in which a graph is used to express important factorization properties about families of probability distributions. These properties allow computationally efficient dynamic programming algorithms to carry out important tasks such as parameter estimation and pattern recognition. Without the expression of factorization, such algorithms would be intractable. Bayesian networks also provide a visual, intuitive, yet mathematically formal graphical description of such probabilistic models, something that can be of enormous assistance when designing a model to solve a given problem.</p><p>A DBN is a type of Bayesian network (Heckerman, <xref ref-type="bibr" rid="B10">1995</xref>) that is ideally suited to sequential data, such as acoustic speech signals in speech recognition or DNA and protein sequences in biological sequence analysis. Because DBNs subsume hidden Markov models (HMMs), and because HMMs have been widely and successfully used in a variety of sequence analysis tasks, it is likely that the much more powerful family of DBNs may further advance the field of bioinformatics. A DBN is constructed using a fixed-length <italic>template</italic> which is unrolled in order to model a sequence of any arbitrary length. The fact that the DBN is described using only a finite number of parameters, but can describe a sequence of unbounded length, is one of the powerful aspects of DBNs. A detailed description of the types of DBNs used in this work, but for the problem domain of speech recognition, can be found in (Bilmes and Bartels, <xref ref-type="bibr" rid="B2">2005</xref>). Because of their ability to model large complex phenomena, DBNs are particularly appropriate for modeling peptide fragment ion intensity. In addition, the DBN's governing parameters (which are automatically learned in this work) are highly interpretable, making them well-suited to provide scientific insight.</p><p>Our fragmentation model, called <italic>Riptide</italic>, consists of a collection of DBNs that capture physical properties of peptide fragmentation. Riptide's design is motivated by the widely accepted <italic>mobile proton model</italic> of peptide fragmentation (Dongre <italic>et al.</italic>, <xref ref-type="bibr" rid="B3">1996</xref>; Wysocki <italic>et al.</italic>, <xref ref-type="bibr" rid="B28">2000</xref>). According to this model, peptide fragmentation by collision-induced dissociation under low-energy conditions is caused by migration of a proton to a location on the peptide backbone and subsequent fragmentation of the peptide into <italic>b</italic>- and <italic>y</italic>-ions. This fragmentation event can be influenced by numerous factors (Dongre <italic>et al.</italic>, <xref ref-type="bibr" rid="B3">1996</xref>). The most closely studied factor influencing cleavage is the effect of adjacent amino acid residues on the probability of cleavage occurring at a particular backbone amide bond. This effect is modeled in detail in the Riptide DBNs. In addition, the primary fragmentation event into <italic>b</italic>- and <italic>y</italic>-ions (corresponding to sequences N-term and C-term to the fragmentation position) is often accompanied by a number of additional fragmentation events: the formation of an <italic>a</italic>-ion by a loss of carbon monoxide from the <italic>b</italic>-ion; the loss of NH<sub>3</sub> or H<sub>2</sub>O (Kinter and Sherman, <xref ref-type="bibr" rid="B13">2000</xref>). Riptide explicitly models these ion formations, both alone and jointly with their precursor ions. This feature is missing in other machine learning approaches, which only model <italic>b</italic>- and <italic>y</italic>-ions (Elias <italic>et al.</italic>, <xref ref-type="bibr" rid="B6">2004</xref>; Wan and Chen, <xref ref-type="bibr" rid="B30">2005</xref>).</p><p>Riptide's probabilistic parameters are trained from previously identified tandem mass spectra. In order to avoid contamination of the training set with incorrectly identified spectra, we generated high-confidence identifications using a combination of seven peptide-identification algorithms, paying special attention to controlling false discoveries. The resulting collection of 1208 peptide-spectrum matches (PSMs) is freely available at <ext-link ext-link-type="uri" xlink:href="http://noble.gs.washington.edu/proj/intense">http://noble.gs.washington.edu/proj/intense</ext-link>.</p><p>The Riptide model detects both known and potentially novel trends in peptide fragment intensity within these high-quality PSMs. Of these trends, perhaps the most provocative is the tendency towards higher intensity <italic>a</italic>-ion peaks and <italic>a</italic>-ion neutral loss peaks from cleavage sites C-term to hydrophobic residues. In addition to providing scientific insight into peptide fragmentation chemistry, the probabilities assigned by the Riptide models are useful for improving peptide identification. We demonstrate that, when feature vectors comprised of Riptide probabilities are used as input to either an SVM or the semi-supervised learning algorithm Percolator, they improve peptide identification at a 1% false discovery rate (FDR) by 10.9 and 12.4%, respectively.</p></sec><sec id="SEC2"><title>2 APPROACH</title><p>Although the details of the Riptide model are complex, the inputs to and outputs from the Riptide training and testing procedure are quite simple (<xref ref-type="fig" rid="F1">Fig. 1</xref>). We start with a collection of high-confidence PSMs generated as described in <xref ref-type="sec" rid="SEC3.2">Section 3.2</xref>. These PSMs are used to train the Riptide model, which consists of a collection of DBNs that model the probability distributions governing peptide fragment ion intensities. The resulting Riptide model is then evaluated on a set of test PSMs, generating for each PSM a feature vector of probabilities. These vectors can then be used as input to analysis software, assigning scores to the PSMs. Examples of analysis software include support vector machines (SVMs) or the semi-supervised learning algorithm Percolator of K&#x000e4;ll <italic>et al.</italic> (<xref ref-type="bibr" rid="B15">2007</xref>) (<xref ref-type="sec" rid="SEC4">Section 4</xref>).
<fig id="F1" position="float"><label>Fig. 1.</label><caption><p>Experimental overview. We start with a collection of high-confidence PSMs. These training PSMs are used to train the Riptide model, which consists of a collection of DBNs that model the probability distributions governing peptide fragment ion intensities. Riptide is used to evaluate testing PSMs to produce a vector of features for each PSM, each feature related to a probability assigned to the PSM by one of the Riptide DBNs. Finally, these feature vectors can be analyzed by additional algorithms (such as SVMs) to produce scores for the test PSMs.</p></caption><graphic xlink:href="btn189f1"/></fig>
</p><sec id="SEC2.1"><title>2.1 Riptide training</title><p>Training the Riptide model proceeds in two main steps, portrayed in <xref ref-type="fig" rid="F2">Figure 2</xref>. The first step starts with the high-confidence PSMs, produced as described in <xref ref-type="sec" rid="SEC3.2">Section 3.2</xref>. Each of the spectra for these positive PSMs is also associated with a randomly generated peptide to create a set of negative PSMs. We use these two classes of PSMs (positive and negative) to train a set of &#x02018;positive&#x02019; and &#x02018;negative&#x02019; dynamic Bayesian networks (<xref ref-type="fig" rid="F2">Fig. 2</xref>A). These trained DBNs are then used to evaluate the test PSMs, yielding for each PSM and each type of DBN a pair of probabilities (positive and negative). In addition to the raw probabilities, we also include the ratio between them, which we found helped in discrimination (<xref ref-type="sec" rid="SEC2.3">Section 2.3</xref>). Thus, each of the original training PSMs is represented as a length three vector, with three scalar values for each kind of DBN in the original Riptide training (<xref ref-type="fig" rid="F2">Fig. 2</xref>B, right). These vectors can then be used during testing as input to either an SVM or the Percolator (<xref ref-type="sec" rid="SEC4">Section 4</xref>).
<fig id="F2" position="float"><label>Fig. 2.</label><caption><p>Riptide overview. The process of training and evaluating Riptide consists of two main stages. (A) The process begins with high-confidence PSMs (positive PSMs, top). Each of the spectra for these positive PSMs is also associated with a randomly generated peptide to create a set of negative PSMs (bottom). These two classes of PSMs are used to train a set of DBNs, one positive and one negative for each ion series. (B) The trained DBNs are then used to evaluate testing PSMs, yielding for each PSM and each type of DBN a pair of probabilities (positive and negative) as well as the ratio between them, a log odds ratio. Thus, each of the testing PSMs is represented as a vector of scalar values, three values for each DBN. These vectors are then used during testing as input to either an SVM or the Percolator algorithm (<xref ref-type="sec" rid="SEC4">Section 4</xref>).</p></caption><graphic xlink:href="btn189f2"/></fig>
</p></sec><sec id="SEC2.2"><title>2.2 Bayesian networks</title><p>At the core of the Riptide algorithm are two types of DBNs that model the probability distributions governing spectrum ion intensities. One section of a DBN template is called a <italic>frame</italic>. Three frames for each model are shown in <xref ref-type="fig" rid="F3">Figure 3</xref> using standard DBN diagramming semantics. Nodes in the model represent random variables, solid edges signify potential dependencies between these variables, and dashed edges signify switching edges (Bilmes and Bartels, <xref ref-type="bibr" rid="B2">2005</xref>).
<fig id="F3" position="float"><label>Fig. 3.</label><caption><p>The two types of Riptide DBNs. The first class of DBNs (A) models distributions of ion fragment intensities individually, conditioning on the amino acids flanking the cleavage site that fragments to produce that particular ion. The second class of DBNs (B) models the distributions of ion fragment intensities in pairs, incorporating dependencies between related ions that result from fragmentation at the same site. Observed nodes are shaded gray; hidden nodes are not shaded. The nodes at the top of each center frame are connected to identical nodes in previous and subsequent frames. Solid lines indicate conditional dependencies, while dashed lines indicate a switching parent relationship, a special form of conditional dependency.</p></caption><graphic xlink:href="btn189f3"/></fig>
</p><p>The first network type is the <italic>single-ion</italic> model, which captures information about the influence of peptide chemistry on individual ion series (<xref ref-type="fig" rid="F3">Fig. 3</xref>A). Intuitively, this model learns probability relationships that can be expressed as &#x02018;<italic>b</italic>-ions N-term to proline tend to have high intensity&#x02019; or &#x02018;<italic>y</italic>-ions C-term to aspartate have low intensity&#x02019;. The second type of network is the <italic>paired-ion</italic> model, which captures information about relationships between pairs of ions of related types (<xref ref-type="fig" rid="F3">Fig. 3</xref>B). These models learn probability relationships that can be expressed as &#x02018;<italic>b</italic>- and <italic>y</italic>-ions that result from the same cleavage location tend to have intensities of similar height.&#x02019; Taken together, these two kinds of models are capable of capturing a rich set of probabilistic relationships governing fragment ion intensities. We train specific instances of each model type for different ion series and pairs of ion series. For example, Riptide contains a single-ion model trained on <italic>b</italic>-ions alone, and a paired-ion model trained on <italic>b</italic>- and <italic>y</italic>-ions jointly. Additional details about each of these model types are given subsequently.</p><sec id="SEC2.2.1"><title>2.2.1 Single ion models</title><p>A graphical representation of the single-ion model is shown in <xref ref-type="fig" rid="F3">Figure 3</xref>A. It models the relationship between a spectrum and a particular series of fragment ions from an associated peptide. Each frame corresponds to a single fragmentation location in the peptide and the intensity of a peak in the mass spectrum associated with that fragmentation. For example, a model of the <italic>b</italic>-ions resulting from the peptide EAMPK would contain four frames, with the first frame corresponding to the <italic>b</italic>-ion resulting from fragmentation at the amide bond between the peptide fragments E and AMPK.</p><p>For a given set of training PSMs, one single-ion model is trained for each of the 18 different ion series. These include nine singly charged and nine doubly charged ion series, the latter denoted with a &#x02018;<sup>++</sup>&#x02019;. For each charge state, we model three primary ion series (<italic>b</italic>, <italic>y</italic> and <italic>a</italic>), each of these primary series with a loss of water (denoted <italic>b</italic><sup>&#x025cb;</sup>, <italic>y</italic><sup>&#x025cb;</sup> and <italic>a</italic><sup>&#x025cb;</sup>) and a loss of ammonia (denoted <italic>b</italic><sup>*</sup>, <italic>y</italic><sup>*</sup> and <italic>a</italic><sup>*</sup>). Because we train a separate model on negative and positive sets of PSMs, this procedure results in 36 single-ion models (3 ion types&#x02009;&#x000d7;&#x02009;3 loss types&#x02009;&#x000d7;&#x02009;2 charge-states&#x02009;&#x000d7;&#x02009;2 training sets).</p><p>At the center of each frame of the single-ion model is a random variable that represents ion intensity as the percentile rank of the observed peak in the mass spectrum using a number between 0 and 1, derived as described in <xref ref-type="sec" rid="SEC3.1">Section 3.1</xref>. We model this variable using a mixture of three Gaussians, for a total of eight free parameters (three means, three variances and two weights). Three Gaussians were found to match natural ion intensity distributions well: most distributions have a single large peak, tapering into a broad background distribution modeled by the other two Gaussians.</p><p>The intensity variable is dependent on several other variables, which can be divided into two groups. The first group consists of two variables that influence the probability of a peak being detected in the spectrum. As physical instruments, mass spectrometers are only capable of detecting ions within a finite range of <italic>m</italic>/<italic>z</italic> values. Thus, the first variable indicates whether the particular peak is within the detectable portion of the mass spectrum, while the second indicates whether a peak is indeed detected. We do not wish to assign low probability to a peptide with an undetected ion if that ion is physically undetectable; hence, when both of these variables are false, we set the center intensity variable to unity. On the other hand, if an ion is detectable but not detected, then we penalize it during testing by using the (usually low) probability for a zero intensity ion. Finally, if an ion is both detectable and detected, then we use the corresponding intensity value to train (or test) the appropriate one-dimensional three-component Gaussian mixture at the center intensity node.</p><p>The second group of three variables influence the intensity of the fragment ion assuming that it is detected. Two variables represent the flanking amino acids immediately to the left (N-term) and right (C-term) of the fragmentation position in the peptide. These positions have been shown to have a strong effect on the probability of detecting an ion resulting from the cleavage position at that position (Tabb <italic>et al.</italic>, <xref ref-type="bibr" rid="B26">2004</xref> Wysocki <italic>et al.</italic>, <xref ref-type="bibr" rid="B28">2000</xref>). The third variable represents the position of the peak along the <italic>m</italic>/<italic>z</italic> axis of the spectrum relative to the intact peptide <italic>m</italic>/<italic>z</italic> (using an integer between 0 and 4). This variable accounts for the bias towards center fragmentation in peptides. These three variables are mixed together using a hidden mixing variable, the distribution of which depends on the region of the mass spectrum. The mixing procedure allows what would be a very high number of training parameters (20 left-flanking residues&#x02009;&#x000d7;&#x02009;20 right flanking residues&#x02009;&#x000d7;&#x02009;5 peptide regions&#x02009;&#x000d7;&#x02009;8 Gaussian parameters=16 000) to a much smaller number ((20+20+5) * 8=360), using the switching parent mechanism. Thus, the mixing node allows us to train a much richer model on much fewer data than would otherwise be possible. An edge connects the peptide region to this mixing node because intensities from fragmentations in different regions of the peptide will have slightly different dependencies on flanking residues and peptide position. For example, the extreme C-term and N-term regions of the peptide will tend to have low intensities regardless of flanking residues (Havilio <italic>et al.</italic>, <xref ref-type="bibr" rid="B11">2003</xref>), whereas towards the center of the peptide differences in intensity are more influenced by flanking residues.</p></sec><sec id="SEC2.2.2"><title>2.2.2 Paired-ion models</title><p>A graphical representation of the paired-ion model type is shown in <xref ref-type="fig" rid="F3">Figure 3</xref>B. This type of model attempts to capture the pairwise relationships between related ions of different types. Some pairs of ion types are closely related because they result from the same fragmentation event (e.g. <italic>b</italic><sub><italic>i</italic></sub> and <italic>y</italic><sub><italic>n</italic>&#x02212;<italic>i</italic></sub>, for a peptide of length <italic>n</italic>). This is because under low-energy conditions, the <italic>b</italic>-ion and <italic>y</italic>-ion fragments co-exist in a loose complex; the two members of this dimer compete for the proton, with assignment of charge being determined by the proton affinities of the two ions (Paizs and Suhai, <xref ref-type="bibr" rid="B21">2004</xref>). Fragment cannot be detected if they are not charged, so this competition matters for the detected ion intensities. Other pairs of ion types are related because one type can produce the other upon secondary fragmentation (<italic>b</italic> and <italic>b</italic><sup>&#x025cb;</sup>). Still others are related because they represent different charge states of the same ion (<italic>b</italic> and <italic>b</italic><sup>++</sup>). Thus, we train paired-ion models for each of the following 15 pairs of related ions: <italic>b</italic>/<italic>y</italic>, <italic>b</italic>/<italic>b</italic><sup>&#x025cb;</sup>, <italic>y</italic>/<italic>y</italic><sup>&#x025cb;</sup>, <italic>b</italic>/<italic>a</italic>, <italic>b</italic>/<italic>b</italic><sup>*</sup>, <italic>y</italic>/<italic>y</italic><sup>*</sup>, <italic>b</italic>/<italic>b</italic><sup>++</sup>, <italic>y</italic>/<italic>y</italic><sup>++</sup>, <italic>b</italic><sup>&#x025cb;</sup>/<italic>b</italic><sup>&#x025cb;++</sup>, <italic>y</italic><sup>&#x025cb;</sup>/<italic>y</italic><sup>&#x025cb;++</sup>, <italic>a</italic>/<italic>a</italic><sup>++</sup>, <italic>b</italic><sup>*</sup>/<italic>b</italic><sup>*++</sup>, <italic>y</italic><sup>*</sup>/<italic>y</italic><sup>*++</sup>, <italic>y</italic>/<italic>a</italic> and <italic>b</italic><sup>++</sup>/<italic>y</italic><sup>++</sup>. For clarity, <xref ref-type="fig" rid="F3">Figure 3</xref> shows the model for <italic>b</italic>- and <italic>y</italic>-ions only; other pairs of ions are modeled analogously. As for the single-ion models, one model is trained on each ion series for a positive and negative set of training PSMs (<xref ref-type="fig" rid="F2">Fig. 2</xref>), producing 30 trained models. Like the single-ion models, each frame in a paired-ion model corresponds to a single fragmentation location in a peptide and models the intensities of a pair of peaks in a mass spectrum associated with that fragmentation. For example, the first frame of a model of the +1 <italic>b</italic>- and <italic>y</italic>-ions resulting of the peptide EAMPK would model the <italic>b</italic>-ion E and the <italic>y</italic>-ion AMPK.</p><p>The three variables along the bottom of <xref ref-type="fig" rid="F2">Figure 2</xref> represent peak intensity. Two of these variables model the intensities of the ions individually and are essentially identical to the intensity variable described above for the single-ion models. These variables also use a mixture of three 1D Gaussians and are used if only one or the other ion is detected but not both. On the other hand, if both ions are detected, then the center variable models the ions jointly using a mixture of nine 2D Gaussians. Regardless of which pattern of ions is detected, the distribution corresponding to the undetected pattern of ions is given a unity score. Whether ions are detected or not is indicated using the three variables directly above each of the intensity variables. Finally, the three variables indicating whether ions are detected or not are dependent on the peptide region, which is identical to the corresponding node in the single ion models. The dependence of these three variables on peptide region captures the fact that some pairs of ion types (<italic>b</italic> and <italic>y</italic>) from the center of a peptide are more likely to be observed simultaneously in the spectrum.</p></sec></sec><sec id="SEC2.3"><title>2.3 Using Riptide to evaluate PSMs</title><p>The final Riptide model consists of 66 dynamic Bayesian networks, including a positive and negative model for each of 18 single-ion series and 15 pairs of ion series ((18+15) * 2&#x02009;=&#x02009;66). Once these networks have been trained, they can be used to assign a probability to the ion series from any given PSM. Evaluating a PSM using one of the models described above yields the joint probability of the observed values for a particular ion series intensity pattern <italic>i</italic> and peptide <italic>p</italic> given the trained model <italic>M</italic>, <italic>Pr</italic>(<italic>i</italic>, <italic>p</italic>|<italic>M</italic>). Each ion series has two probabilities assigned to it: one for the model trained with positive PSMs, and one for the model trained with negative PSMs. We use these two probabilities to calculate a log odds ratio for each ion series and PSM. Hence, the final measure of how well a given PSM ion series and for a particular peptide matches expectation is given by
<disp-formula id="M1"><label>(1)</label><graphic xlink:href="btn189m1"/></disp-formula>
where <italic>M</italic><sub>+</sub> and <italic>M</italic><sub>&#x02212;</sub> are the positive and negative models, respectively. Evaluating the log odds ratios for each of the 33 positive and 33 negative models yields a vector of an additional 33 values for each PSM. Thus, the final vector summarizing each PSM is 99 elements long. We use these vectors as input to other algorithms such as SVMs, described in more detail in <xref ref-type="sec" rid="SEC4">Section 4</xref>.</p></sec></sec><sec sec-type="methods" id="SEC3"><title>3 METHODS</title><sec id="SEC3.1"><title>3.1 Spectrum preprocessing</title><p>Before any particular spectrum is analyzed, we transform the intensities by sorting the peaks in ascending order by intensity and calculating, for that peak, the fraction of peaks that are less than or equal to that intensity. We use these fractional representations of peak intensities to train the Riptide dynamic Bayesian networks. Thus, in a hypothetical spectrum with 10 peaks, the peak with the highest intensity would be assigned a normalized rank of 1.00, and the peak with the lowest intensity would be assigned a normalized rank of 0.10. This intensity transformation is similar to the relative rank value used in (Wan and Chen, <xref ref-type="bibr" rid="B30">2005</xref>) and reduces the effect of variations in dynamic range and noise.</p></sec><sec id="SEC3.2"><title>3.2 Training dataset</title><p>To generate the MS/MS data, an aqueous soluble protein sample from <italic>Escherichia coli</italic> lysate was reduced, carbamidomethylated and digested with trypsin in the presence of an acid-labile detergent (RapiGest, Waters Corp., Milford, MA). The resulting peptides were analyzed by &#x003bc;LC&#x02013;MS/MS using the &#x003bc;lti-dimensional protein identification technology (Washburn <italic>et al.</italic>, <xref ref-type="bibr" rid="B29">2001</xref>) on a ThermoFinnigan Orbitrap LTQ mass spectrometer, yielding a total of 112 329 spectra.</p><p>We wanted to avoid learning spurious relationships from PSMs with MS/MS spectra that contained heterogeneous populations of peptides. To select spectra from homogeneous populations of peptides, we used the isotope detection algorithm HardKl&#x000f6;r (Hoopmann <italic>et al.</italic>, <xref ref-type="bibr" rid="B12">2007</xref>). We included MS/MS spectra that had an associated MS spectrum with only one isotope distribution within a window of 3 <italic>m</italic>/<italic>z</italic> of the precursor ion over three out of four MS spectra, yielding a total of 51 179 MS/MS spectra.</p><p>The spectra were searched against the <italic>E.coli</italic> protein sequence database using several algorithms to mitigate the bias resulting from any one algorithm or algorithm class: S<sc>EQUEST</sc> (Eng <italic>et al.</italic>, <xref ref-type="bibr" rid="B5">1994</xref>; Yates <italic>et al.</italic>, <xref ref-type="bibr" rid="B31">1995</xref>), OMMSA (Geer <italic>et al.</italic>, <xref ref-type="bibr" rid="B9">2004</xref>), ProbID (Zhang <italic>et al.</italic>, <xref ref-type="bibr" rid="B33">2002</xref>), PepNovo (Frank and Pevzner, <xref ref-type="bibr" rid="B8">2005</xref>), Lutefisk (Taylor and Johnson, <xref ref-type="bibr" rid="B24">1997</xref>), Inspect (Tanner <italic>et al.</italic>, <xref ref-type="bibr" rid="B27">2005</xref>) and GutenTag (Tabb <italic>et al.</italic>, <xref ref-type="bibr" rid="B25">2003</xref>). These algorithms were chosen to represent the diversity of existing MS/MS analysis software and according to source code and executable availability. Parameters for each algorithm were set as appropriate to search all peptides (regardless of enzyme specificity) with a precursor mass tolerance of +/&#x02212;2.5 Da. PSMs from each algorithm were accepted if they met the following criteria: a minimum length of six amino acids, a charge of +2, fully tryptic (ending in K or R) with no missed cleavages. The algorithms GutenTag and S<sc>EQUEST</sc> had additional filters of a minimum DeltCN of 0.20 and 0.10, respectively. Many of the algorithms return multiple PSMs for a particular spectrum; in these cases, the top PSM (according to the primary scoring method for that algorithm) that matched the above criteria was selected as the PSM for that algorithm and spectrum. The FDR for each algorithm was estimated by searching the spectra against a randomly shuffled sequence database, consisting of randomly generated proteins with the same amino acid frequencies and length distribution as the original sequence database. PSMs are sorted by the primary scoring metric, and the FDR at a given primary scoring threshold is equal to the number of identifications to the shuffled database divided by the number of identifications to the real database above that threshold. The handful of short peptides that occurred in both the real and shuffled sequence databases were ignored for the purpose of calculating FDR. Thresholds for accepting PSMs generated by each algorithm were set consistent with an FDR of 1%.</p><p>In some cases, the PSMs contain contradictory assignments of different peptides by different algorithms to the same spectrum. We remove these contradictory PSMs from the set. Finally, we require each PSM to be confirmed by at least two algorithms, and each peptide to be confirmed by at least two spectra. The resulting 1208 charge +2 PSMs were used to train Riptide.</p></sec><sec id="SEC3.3"><title>3.3 Testing datasets</title><p>For validation, we use a publicly available tandem MS dataset from Klammer <italic>et al.</italic> (<xref ref-type="bibr" rid="B14">2007</xref>), available as the 60cm dataset at <ext-link ext-link-type="uri" xlink:href="http://noble.gs.washington.edu/proj/retention/data/data.html">http://noble.gs.washington.edu/proj/retention/data/data.html</ext-link>. The dataset consists of a collection of 18 149 spectra derived from a yeast whole-cell lysate as described previously (Klammer <italic>et al.</italic>, <xref ref-type="bibr" rid="B14">2007</xref>). This data set was used to demonstrate the model's ability to generalize across different peptide sets.</p><p>The yeast protein sequence database used to search the test dataset was first digested to tryptic peptides <italic>in silico</italic>, by cleaving protein sequences after K or R except when followed by P, and allowing internal missed cleavages. The resulting peptides are then indexed by their mass in Daltons (Da) rounded to the nearest integer. For each test spectrum, we created a list of candidate peptides by rounding the spectrum's mass in Da (assuming charge of +2) to the nearest integer, and extracting all peptides within +/&#x02212;3 Da of the rounded mass. For a sequence database of sufficient size, this list of candidate peptides will be prohibitively large; hence, to winnow this list further, we apply a subsequent filtering step akin to the S<sc>EQUEST</sc> Sp score (Eng <italic>et al.</italic>, <xref ref-type="bibr" rid="B5">1994</xref>).</p></sec><sec id="SEC3.4"><title>3.4 SVM training</title><p>For the SVM, we use a Gaussian kernel, and hyperparameters <italic>C</italic> and &#x003c3;. <italic>C</italic> is the soft-margin penalty, or the penalty for misclassified examples, and &#x003c3; is the width of the Gaussian used. These hyperparameters are selected using 5-fold nested cross-validation, where the parameter with the largest area under the receiver operating characteristic (ROC) curve is selected. The SVM was implemented using the publicly available software package PyML <ext-link ext-link-type="uri" xlink:href="http://pyml.sourceforge.net">http://pyml.sourceforge.net</ext-link>).</p></sec></sec><sec sec-type="results" id="SEC4"><title>4 RESULTS</title><sec id="SEC4.1"><title>4.1 Validation with a sequence database search</title><p>We test Riptide in the context of a three-stage computational pipeline, in which (1) candidate PSMs are generated by a reimplementation of S<sc>EQUEST</sc>. (C.Y.Park <italic>et al.</italic>, In Press); (2) these PSMs areevaluated by Riptide, and (3) the resulting feature vectors are post-processed either by an SVM or by the semi-supervised learning algorithm known as Percolator (K&#x000e4;ll <italic>et al.</italic>, <xref ref-type="bibr" rid="B15">2007</xref>). We train Riptide and the SVM using target and decoy PSMs from <italic>E.coli</italic> (<xref ref-type="sec" rid="SEC3.2">Section 3.2</xref>), and we then measure the ability of the pipeline to discriminate between target and decoy PSMs, using spectra generated from a yeast whole-cell lysate (<xref ref-type="sec" rid="SEC3.3">Section 3.3</xref>).</p><p>An SVM is a binary classifier that projects feature vectors into a high-dimensional space and learns an optimal separating hyperplane between positive and negative examples in that space (<xref ref-type="sec" rid="SEC3.4">Section 3.4</xref>). In this case, we use an SVM to learn to discriminate between positive and negative PSMs, using the 99-dimensional feature vectors generated by Riptide. After SVM training, test set PSMs are scored using the discriminant value of the SVM classifier, which is the distance between the test PSM's feature vector and the SVM hyperplane. If the scoring function is working well, then correct PSMs will be assigned positive discriminant scores, and incorrect PSMs will be assigned negative scores.</p><p><xref ref-type="fig" rid="F4">Figure 4</xref>A compares the performance of Riptide+SVM with the performance of XCorr, the score function used by S<sc>EQUEST</sc> [re-implemented in the software package Crux (C.Y.Park <italic>et al.</italic>, In Press)]. To generate thefigure, we searched each spectrum in the test set against a shuffled decoy version of the same protein sequence database (Klammer <italic>et al.</italic>, <xref ref-type="bibr" rid="B14">2007</xref>). We use the number of matches to the decoy database at a particular score threshold to estimate the rate of false identifications among the target PSMs (K&#x000e4;ll <italic>et al.</italic>, <xref ref-type="bibr" rid="B16">2008</xref>). For each PSM, we then compute a <italic>q</italic> value, which is defined as the minimal FDR threshold at which the PSM is deemed significant (Storey and Tibshirani, <xref ref-type="bibr" rid="B23">2003</xref>). Each series in the figure plots the number of target PSMs identified as a function of <italic>q</italic>-value threshold. We selected this mode of evaluation because it closely matches the goal of the typical mass spectrometrist: identifying the largest number of peptides with the lowest rate of false identifications. Riptide with the static SVM outperforms S<sc>EQUEST</sc> by 10.8% at a 1% FDR. In this experiment, the Riptide DBNs failed on many short (length seven or less) peptides, so they are not included in the analysis. If these peptides are included, performance deteriorates dramatically.
<fig id="F4" position="float"><label>Fig. 4.</label><caption><p>Positive peptide identifications as a function of <italic>q</italic> -value (a measure of FDR). The Riptide scoring function is compared with the S<sc>EQUEST</sc> scoring function <italic>Xcorr</italic>, to test the utility of the SVM normalized discriminant score function (A). In addition, the Riptide DBN feature vectors are used as input to the algorithm Percolator (K&#x000e4;ll <italic>et al.</italic>, <xref ref-type="bibr" rid="B15">2007</xref>), and are compared with the original Percolator features (B).</p></caption><graphic xlink:href="btn189f4"/></fig>
<fig id="F5" position="float"><label>Fig. 5.</label><caption><p>Distribution of <italic>a</italic>-ion intensities from fragmentation at sites C-term to hydrophobic or polar residues. Difference is significant at <italic>P</italic> &#x0226a; 0.0001.</p></caption><graphic xlink:href="btn189f5"/></fig>
</p><p>In addition to testing the static SVM post-processor, we test Riptide in conjunction with the semi-supervised learning algorithm, Percolator (K&#x000e4;ll <italic>et al.</italic>, <xref ref-type="bibr" rid="B15">2007</xref>). Percolator uses an SVM to iteratively learn to discriminate between correct and incorrect PSMs by using PSMs from a decoy dataset as a proxy for incorrect PSMs in the target dataset. As originally described, Percolator uses a collection of 20 features, including several features derived from the algorithm S<sc>EQUEST</sc>: e.g. <italic>Xcorr</italic>, <italic>Sp</italic>, <italic>deltCN</italic> as well as features describing the trypticity of the peptide termini, among others. We tested three variants of Percolator: using the original 20 features, using Riptide's 99 features and using all 119 features. The results are shown in <xref ref-type="fig" rid="F4">Figure 4</xref>B. When Riptide's feature vectors are combined with those used in the original Percolator publication, we obtain 12.4% improvement in positives at 1% false discovery (<xref ref-type="fig" rid="F4">Fig. 4</xref>B).</p><p>In <xref ref-type="fig" rid="F4">Figure 4</xref>B, the original features from (K&#x000e4;ll <italic>et al.</italic>, <xref ref-type="bibr" rid="B15">2007</xref>) outperform the Riptide features when both are used alone. This result is likely due to the use of information in generating Percolator features unavailable to Riptide, in particular, protein-level information. Thus, Riptide-derived features will likely benefit discrimination most when combined with high-level, non-fragmentation based-information.</p></sec><sec id="SEC4.2"><title>4.2 Analysis of learned fragmentation probabilities</title><p>An additional benefit of using DBNs in the Riptide model is that the probability distributions learned by the networks can be readily interpreted to produce scientific insights. We examine the probability distributions governing ion fragment intensities learned by the single-ion and paired-ion types of Riptide models in <xref ref-type="fig" rid="F6">Figure 6</xref>.
<fig id="F6" position="float"><label>Fig. 6.</label><caption><p>Learned parameters of the Riptide model. (<bold>A</bold>) Displays the mean peak intensities for different residues and ion types learned using the Riptide single-ion models. Each cell shows the mean normalized intensity value for a particular ion series and flanking residue. For the left heat map, residues designated are those to the left of the amide bond fragmented to produce ions of that type (i.e. the amide bond is itself C-term to the residue), while for the right heat map, the residues designated are those to the right of the fragmented amide bond (i.e. the amide bond is itself N-term to the residue). The top image was created using matrix2png (Pavlidis and Noble, <xref ref-type="bibr" rid="B20">2003</xref>). (<bold>B</bold>) Displays the 2D Gaussian distributions of peak intensities for pairs of ions learned using the Riptide paired-ion models. Each plot shows the joint distribution of ion intensities resulting from the same amide bond cleavage; thus, for example, points on the <italic>b</italic>/<italic>y</italic> plot corresponds to <italic>b</italic><sub><italic>i</italic></sub>/<italic>y</italic><sub><italic>n</italic>&#x02212;<italic>i</italic></sub> pairs, for a peptide of length <italic>n</italic>. The color bar scale indicates natural log probability.</p></caption><graphic xlink:href="btn189f6"/></fig>
</p><p>In <xref ref-type="fig" rid="F6">Figure 6</xref>A, we examine the distributions of intensities learned for particular residues and ion types by the single-ion models. Each plot shows the mean intensity for each of the 18 single-ion models and the 20 residues that can be to the left and right (N-term and C-term) of the cleaved amide bond. Several expected trends can be detected: the high intensities of <italic>b</italic>- and <italic>y</italic>-ions; the high intensities of cleavages N-term to P, and corresponding low intensities of cleavages C-term to P. Other trends that have not been as widely noted in the peptide fragmentation literature are also present: the increased prevalence of +2 <italic>y</italic>-ions when basic residues are C-term to the fragmentation location; and the increased intensity of singly charged <italic>a</italic>-ions when hydrophobic residues are N-term to the fragmentation site. The first effect makes sense from physical principles. We examined the latter effect more closely by looking at the raw distribution of <italic>a</italic>-ion intensities near hydrophobic residues. Specifically, we compared <italic>a</italic>-ion intensities that resulted from fragmentation events C-term to the hydrophobic residues YILMFWC (where C is modified with iodoacetamide) with the polar residues RKDENQ (<xref ref-type="fig" rid="F5">Fig. 5</xref>). The two distributions are significantly different from one another (Kolmogorov&#x02013;Smirnov test, <italic>P</italic> &#x0226a; 0.0001).
</p><p>In <xref ref-type="fig" rid="F6">Figure 6</xref>B, we examine the 2D distributions learned by the joint intensity node in the paired-ion models. Here we analyze how pairs of ion intensities resulting from the same amide bond cleavage depend on each other. Again, several expected trends can be detected: prominence of <italic>b</italic>- and <italic>y</italic>-ions, with relatively higher prominence for <italic>y</italic>-ions (panel <italic>b</italic>/<italic>y</italic>); relatively low values for <italic>a</italic> and <italic>a</italic><sup>++</sup> ions, but with preference for <italic>a</italic> (panel <italic>a</italic>/<italic>a</italic><sup>++</sup>). Other suggestive trends can also be found: the apparent correlation between <italic>b</italic>-ions and their respective neutral losses (diagonal plumes on the right of panels <italic>b</italic>/<italic>b</italic><sup>&#x025cb;</sup> and <italic>b</italic>/<italic>b</italic><sup>*</sup>); the qualitative difference between plots showing <italic>b</italic>-ion neutral losses and their charge +2 species, on the one hand, and <italic>y</italic>-ion neutral losses and their charge +2 species, on the other (<italic>b</italic><sup>&#x025cb;</sup>/<italic>b</italic><sup>&#x025cb;++</sup> and <italic>b</italic><sup>*</sup>/<italic>b</italic><sup>*++</sup> versus. <italic>y</italic><sup>&#x025cb;</sup>/<italic>y</italic><sup>&#x025cb;++</sup> and <italic>y</italic><sup>*</sup>/<italic>y</italic><sup>*++</sup>). The <italic>y</italic>-ions possess a prominent plume at the top of the plots, showing increased prevalence of +2 neutral losses at low +1 charge states, relative to <italic>b</italic>-ions.</p></sec></sec><sec sec-type="discussion" id="SEC5"><title>5 DISCUSSION</title><p>We have presented Riptide, which models peptide fragmentation chemistry using a collection of DBNs trained from high-quality PSMs. Riptide can provide insights into fragmentation biochemistry, and feature vectors produced by Riptide can be used as input to further machine learning algorithms to improve peptide identification.</p><p>The Riptide models generalizes well across PSMs from different organisms: we train our model on PSMs from <italic>E.coli</italic> and test on PSMs from the yeast <italic>Saccharomyces cerevisiae</italic>. This good generalization is aided by the DBN machinery's ability to control model complexity through switching parents, dramatically reducing the number of trainable parameters. It is unlikely that a model taking into account, for example, C-term and N-term flanking amino acids could be trained on a few thousand spectra without some analogous parameter-reduction machinery.</p><p>Of course, Riptide will likely not generalize well across all types of MS/MS peptide fragmentation data. For example, using different methods of activating peptide ions, such as electron transfer dissociation (ETD) (Mikesh <italic>et al.</italic>, <xref ref-type="bibr" rid="B19">2007</xref>) or electron collision dissociation (ECD) (Zubarev, <xref ref-type="bibr" rid="B34">2004</xref>), would likely require retraining the model. Furthermore, very long or very short peptides (as noted in <xref ref-type="sec" rid="SEC4.1">Section 4.1</xref>) may also exhibit different chemistries that subvert the Riptide model. However, one of the benefits of the learning approach used here is that Riptide is not static and can improve as data improves and as technology and protocols change. For example, in this study we focused on fragmentation of tryptic peptides of charge state +2, because these are the most common peptides in the samples we analyze with collision induced dissociation. But different samples generated from different proteases or analyzed with different fragmentation technologies could be used to train the Riptide models. A related advantage of the machine learning approach is that new DBNs can be applied to arbitrary ion series. In this work, we focused on collision-induced dissociation fragmentation spectra from +2 peptides. An obvious extension would be to apply the DBNs to different charge states, such as +1 and +3 or higher. Also, ETD and ECD have been shown to be useful in proteomics, but produce prevalent <italic>c</italic>- and <italic>z</italic>-ions, rather than <italic>b</italic> and <italic>y</italic>. Given appropriate training data, Riptide could learn fragmentation patterns from these ion series.</p><p>In a sense, the two overall goals of Riptide&#x02014;learning about peptide fragmentation biochemistry and improving our ability to identify spectra&#x02014;are at odds with respect to each other. This tension correlates with the observation that, in general, DBNs admit two different methods of parameter training. On the one hand, there is <italic>generative training</italic>, where optimizing the objective function means that the corresponding joint probability distribution should best describe the data. As a simple example, given a DBN representation of the joint distribution of intensity and peptides <italic>Pr</italic>(<italic>i</italic>,<italic>p</italic>|&#x003b8;), where &#x003b8; are model parameters, generative model training adjusts &#x003b8; so that this joint distribution is as accurate as possible. <italic>Discriminative training</italic>, on the other hand, adjusts the parameters of the model so that classification accuracy is as high as possible. For example, using Bayes rule, we can form the posterior <italic>Pr</italic>(<italic>p</italic>|<italic>i</italic>, &#x003b8;)=<italic>Pr</italic>(<italic>i</italic>, <italic>p</italic>|&#x003b8;)/<italic>Pr</italic>(<italic>i</italic>|&#x003b8;) and then choose the <italic>p</italic> that maximizes this posterior. Adjusting the parameters &#x003b8; to minimize the error rate of a so-formed Bayes decision rule would constitute discriminative training. Generative training is computationally cheap relative to discriminative training. Therefore, in this work we have simulated a discriminative training procedure by explicitly training positive and negative models separately. This latter choice was also motivated by the desire to obtain interpretable probabilistic parameters, which a model trained solely on positive PSMs allows. In future work, we plan to experiment by using a fully discriminative Riptide model for peptide identification and using a separate, fully generative model for investigating fragmentation phenomena.</p><p>Although Riptide is relatively fast in real time (on the order of a minute per spectrum for the databases considered here), it is slow compared to other commonly used PSM evaluation metrics, such as <italic>Xcorr</italic>. This is tolerable, because there is a long history in MS/MS analysis software of using fast preliminary scores to pre-filter peptides before handing them off to the sensitive, yet expensive, final scoring routines. The running time for Riptide to score a given spectrum scales approximately as <italic>O</italic>(<italic>lN</italic><sub><italic>p</italic></sub><italic>N</italic><sub><italic>i</italic></sub><italic>log</italic>(<italic>N</italic><sub><italic>s</italic></sub>)), where <italic>l</italic> is the average length of a peptide, <italic>N</italic><sub><italic>p</italic></sub> is the number of candidate peptides for that spectrum, <italic>N</italic><sub><italic>i</italic></sub> is the number of ion series under consideration, and <italic>N</italic><sub><italic>s</italic></sub> is the number of peaks in the particular spectrum.</p><p>Currently Riptide is implemented in a combination of C++ and Python code, using the GMTK package for dynamic Bayesian network analysis. GMTK is freely available, and the C++ code is available from the authors upon request. In the near future, we plan to migrate Riptide to C and integrate the code into the sequence database search package Crux. (C.Y. Park <italic>et al.</italic>, In Press). Ultimately, the Crux package will incorporate the probabilities produced by Riptide for PSMs into probabilities for protein identification.</p></sec></body><back><ack><title>ACKNOWLEDGEMENTS</title><p><italic>Funding:</italic> This work was supported by National Institutes of Health awards R01 EB007057 and P41 RR11823.</p><p><italic>Conflict of Interest</italic>: none declared.</p></ack><ref-list><title>REFERENCES</title><ref id="B1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bafna</surname><given-names>V</given-names></name><name><surname>Edwards</surname><given-names>N</given-names></name></person-group><article-title>SCOPE: a probabilistic model for scoring tandem mass spectra against a peptide database</article-title><source>Bioinformatics</source><year>2001</year><volume>17</volume><fpage>S13</fpage><lpage>S21</lpage><pub-id pub-id-type="pmid">11472988</pub-id></element-citation></ref><ref id="B2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bilmes</surname><given-names>J</given-names></name><name><surname>Bartels</surname><given-names>C</given-names></name></person-group><article-title>Graphical model architectures for speech recognition</article-title><source>IEEE Signal Proc. Mag</source><year>2005</year><volume>22</volume><fpage>89</fpage><lpage>100</lpage></element-citation></ref><ref id="B3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dongre</surname><given-names>AR</given-names></name><etal/></person-group><article-title>Influence of peptide composition, gas-phase basicity, and chemical modification on fragmentation efficiency: evidence for the mobile proton model</article-title><source>J. Am. Chem. Soc</source><year>1996</year><volume>118</volume><fpage>8365</fpage><lpage>8374</lpage></element-citation></ref><ref id="B4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dancik</surname><given-names>V</given-names></name><etal/></person-group><article-title><italic>De novo</italic>peptide sequencing via tandem mass spectrometry</article-title><source>J. Comput. Biol</source><year>1999</year><volume>6</volume><fpage>327</fpage><lpage>342</lpage><pub-id pub-id-type="pmid">10582570</pub-id></element-citation></ref><ref id="B5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eng</surname><given-names>JK</given-names></name><etal/></person-group><article-title>An approach to correlate tandem mass spectral data of peptides with amino acid sequences in a protein database</article-title><source>J. Am. Soc. Mass Spectr</source><year>1994</year><volume>5</volume><fpage>976</fpage><lpage>989</lpage></element-citation></ref><ref id="B6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Elias</surname><given-names>JE</given-names></name><etal/></person-group><article-title>Intensity-based protein identification by machine learning from a library of tandem mass spectra</article-title><source>Nature Biotechnology</source><year>2004</year><volume>22</volume><fpage>214</fpage><lpage>219</lpage></element-citation></ref><ref id="B7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Field</surname><given-names>HI</given-names></name><etal/></person-group><article-title>Radars, a bioinformatics solution that automates proteome mass spectral analysis, optimises protein identification, and archives data in a relational database</article-title><source>Proteomics</source><year>2002</year><volume>2</volume><fpage>36</fpage><lpage>47</lpage><pub-id pub-id-type="pmid">11788990</pub-id></element-citation></ref><ref id="B8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Frank</surname><given-names>A</given-names></name><name><surname>Pevzner</surname><given-names>P</given-names></name></person-group><article-title>Pepnovo: de novo peptide sequencing via probabilistic network modeling</article-title><source>Anal. Chem</source><year>2005</year><volume>77</volume><fpage>964</fpage><lpage>973</lpage><pub-id pub-id-type="pmid">15858974</pub-id></element-citation></ref><ref id="B9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Geer</surname><given-names>LY</given-names></name><etal/></person-group><article-title>Open mass spectrometry search algorithm</article-title><source>J. Proteome Res</source><year>2004</year><volume>3</volume><fpage>958</fpage><lpage>964</lpage><pub-id pub-id-type="pmid">15473683</pub-id></element-citation></ref><ref id="B10"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Heckerman</surname><given-names>D</given-names></name></person-group><article-title>A tutorial on learning with Bayesian Networks</article-title><source>Technical report</source><year>1995</year><publisher-loc>Redmond</publisher-loc><publisher-name>Microsoft Corporation</publisher-name></element-citation></ref><ref id="B11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Havilio</surname><given-names>M</given-names></name><etal/></person-group><article-title>Intensity-based statistical scorer for tandem mass spectrometry</article-title><source>Anal. Chem</source><year>2003</year><volume>75</volume><fpage>435</fpage><lpage>444</lpage><pub-id pub-id-type="pmid">12585468</pub-id></element-citation></ref><ref id="B12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoopmann</surname><given-names>MR</given-names></name><etal/></person-group><article-title>High speed data reduction, feature detection, and MS/MS spectrum quality assessment of shotgun proteomics datasets using high resolution mass spectrometry</article-title><source>Anal. Chem</source><year>2007</year><volume>79</volume><fpage>5620</fpage><lpage>5632</lpage><pub-id pub-id-type="pmid">17580982</pub-id></element-citation></ref><ref id="B13"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Kinter</surname><given-names>M</given-names></name><name><surname>Sherman</surname><given-names>NE</given-names></name></person-group><article-title>Protein sequencing and identification using tandem mass spectrometry</article-title><year>2000</year><publisher-loc>New York, NY</publisher-loc><publisher-name>Wiley-Interscience</publisher-name></element-citation></ref><ref id="B14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Klammer</surname><given-names>AA</given-names></name><etal/></person-group><article-title>Improving tandem mass spectrum identification using peptide retention time prediction across diverse chromatography conditions</article-title><source>Anal. Chem</source><year>2007</year><volume>79</volume><fpage>6111</fpage><lpage>6118</lpage><pub-id pub-id-type="pmid">17622186</pub-id></element-citation></ref><ref id="B15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>K&#x000e4;ll</surname><given-names>L</given-names></name><etal/></person-group><article-title>A semi-supervised machine learning technique for peptide identification from shotgun proteomics datasets</article-title><source>Nat. Methods</source><year>2007</year><volume>4</volume><fpage>923</fpage><lpage>925</lpage><pub-id pub-id-type="pmid">17952086</pub-id></element-citation></ref><ref id="B16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>K&#x000e4;ll</surname><given-names>L</given-names></name><etal/></person-group><article-title>Assigning significance to peptides identified by tandem mass spectrometry using decoy databases</article-title><source>J. Proteome Res</source><year>2008</year><volume>7</volume><fpage>29</fpage><lpage>34</lpage><pub-id pub-id-type="pmid">18067246</pub-id></element-citation></ref><ref id="B17"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Lauritzen</surname><given-names>S</given-names></name></person-group><source>Graphical Models</source><year>1996</year><publisher-loc>Princeton, NJ</publisher-loc><publisher-name>Oxford Science Publications, Oxford University Press</publisher-name></element-citation></ref><ref id="B18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mann</surname><given-names>M</given-names></name><etal/></person-group><article-title>Analysis of proteins and proteomes by mass spectrometry</article-title><source>Ann. Rev. Biochem</source><year>2001</year><volume>70</volume><fpage>437</fpage><lpage>473</lpage><pub-id pub-id-type="pmid">11395414</pub-id></element-citation></ref><ref id="B19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mikesh</surname><given-names>LM</given-names></name><etal/></person-group><article-title>The utility of ETD mass spectrometry in proteomic analysis</article-title><source>Biochim. Biophys. Acta</source><year>2007</year><volume>1764</volume><fpage>1811</fpage><lpage>1822</lpage><pub-id pub-id-type="pmid">17118725</pub-id></element-citation></ref><ref id="B20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pavlidis</surname><given-names>P</given-names></name><name><surname>Noble</surname><given-names>WS</given-names></name></person-group><article-title>Matrix2png: a utility for visualizing matrix data</article-title><source>Bioinformatics</source><year>2003</year><volume>19</volume><fpage>295</fpage><lpage>296</lpage><pub-id pub-id-type="pmid">12538257</pub-id></element-citation></ref><ref id="B21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Paizs</surname><given-names>B</given-names></name><name><surname>Suhai</surname><given-names>S</given-names></name></person-group><article-title>Fragmentation pathways of protonated peptides</article-title><source>Mass Spectro. Rev</source><year>2004</year><volume>24</volume><fpage>508</fpage><lpage>548</lpage></element-citation></ref><ref id="B22"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Park</surname><given-names>CY</given-names></name><etal/></person-group><article-title>Rapid and accurate peptide identification from tandem mass spectra</article-title><source>J. Proteome Res</source><year>2008</year></element-citation></ref><ref id="B23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Storey</surname><given-names>JD</given-names></name><name><surname>Tibshirani</surname><given-names>R</given-names></name></person-group><article-title>Statistical significance for genome-wide studies</article-title><source>Pro. Natl. Acad. Sci.USA</source><year>2003</year><volume>100</volume><fpage>9440</fpage><lpage>9445</lpage></element-citation></ref><ref id="B24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Taylor</surname><given-names>JA</given-names></name><name><surname>Johnson</surname><given-names>RS</given-names></name></person-group><article-title>Sequence database searches via <italic>de novo</italic>peptide sequencing by tandem mass spectrometry</article-title><source>Rapid commun. Mass Spectr</source><year>1997</year><volume>11</volume><fpage>1067</fpage><lpage>1075</lpage></element-citation></ref><ref id="B25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tabb</surname><given-names>DL</given-names></name><etal/></person-group><article-title>Gutentag: high-throughput sequence tagging via an empirically derived fragmentation model</article-title><source>Anal. Chem</source><year>2003</year><volume>75</volume><fpage>6415</fpage><lpage>6421</lpage><pub-id pub-id-type="pmid">14640709</pub-id></element-citation></ref><ref id="B26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tabb</surname><given-names>DL</given-names></name><etal/></person-group><article-title>Influence of basic residue content on fragment ion peak intensities in low-energy collision-induced dissociation spectra of peptides</article-title><source>Anal. Chem</source><year>2004</year><volume>76</volume><fpage>1243</fpage><lpage>48</lpage><pub-id pub-id-type="pmid">14987077</pub-id></element-citation></ref><ref id="B27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tanner</surname><given-names>S</given-names></name><etal/></person-group><article-title>InsPecT: Identification of posttranslationally modified peptides from tandem mass spectra</article-title><source>Anal. Chem</source><year>2005</year><volume>77</volume><fpage>4626</fpage><lpage>4639</lpage><pub-id pub-id-type="pmid">16013882</pub-id></element-citation></ref><ref id="B28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wysocki</surname><given-names>VH</given-names></name><etal/></person-group><article-title>Mobile and localized protons: a framework for understanding peptide dissociation</article-title><source>J. Am. Soc. Mass Spectr</source><year>2000</year><volume>35</volume><fpage>1399</fpage><lpage>1406</lpage></element-citation></ref><ref id="B29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Washburn</surname><given-names>MP</given-names></name><etal/></person-group><article-title>Large-scale analysis of the yeast proteome by multidimensional protein identification technology</article-title><source>Nat. Biotechnol</source><year>2001</year><volume>19</volume><fpage>242</fpage><lpage>247</lpage><pub-id pub-id-type="pmid">11231557</pub-id></element-citation></ref><ref id="B30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wan</surname><given-names>Y</given-names></name><name><surname>Chen</surname><given-names>T</given-names></name></person-group><article-title>PepHMM: a hidden Markov model based scoring function for mass spectrometry database search</article-title><source>Anal.l Chem</source><year>2005</year><volume>78</volume><fpage>432</fpage><lpage>437</lpage></element-citation></ref><ref id="B31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yates,III</surname><given-names>JR</given-names></name><etal/></person-group><article-title>Method to correlate tandem mass spectra of modified peptides to amino acid sequences in the protein database</article-title><source>Anal. Chem</source><year>1995</year><volume>67</volume><fpage>1426</fpage><lpage>1436</lpage><pub-id pub-id-type="pmid">7741214</pub-id></element-citation></ref><ref id="B32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yates,III</surname><given-names>JR</given-names></name></person-group><article-title>Mass spectrometry and the age of the proteome</article-title><source>Anal. Chem</source><year>1998</year><volume>33</volume><fpage>1</fpage><lpage>19</lpage></element-citation></ref><ref id="B33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>N</given-names></name><etal/></person-group><article-title>ProbID: a probabilistic algorithm to identify peptides through sequence database searching using tandem mass spectral data</article-title><source>Proteomics</source><year>2002</year><volume>2</volume><fpage>1406</fpage><lpage>1412</lpage><pub-id pub-id-type="pmid">12422357</pub-id></element-citation></ref><ref id="B34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zubarev</surname><given-names>RA</given-names></name></person-group><article-title>Electron-capture dissociation tandem mass spectrometry</article-title><source>Curr. Opin. Biotechnol</source><year>2004</year><volume>15</volume><fpage>12</fpage><lpage>16</lpage><pub-id pub-id-type="pmid">15102460</pub-id></element-citation></ref><ref id="B35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>Z</given-names></name></person-group><article-title>Prediction of low-energy collision-induced dissociation spectra of peptides</article-title><source>Anal. Chem</source><year>2004</year><volume>76</volume><fpage>3908</fpage><lpage>3922</lpage><pub-id pub-id-type="pmid">15253624</pub-id></element-citation></ref></ref-list></back></article>